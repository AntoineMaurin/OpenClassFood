﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿# Projet 5 - OpenFoodRooms## PrésentationCe projet est un exercice de formation Python utilisant les données publiques de l'API OpenFoodFacts.La startup Pur Beurre connait bien les habitudes alimentaires françaises. Leur restaurant, Ratatouille, remporte un succès croissant et attire toujours plus de visiteurs sur la butte de Montmartre.L'équipe a remarqué que leurs utilisateurs voulaient bien changer leur alimentation mais ne savaient pas bien par quoi commencer. Remplacer le Nutella par une pâte aux noisettes, oui, mais laquelle ? Et dans quel magasin l'acheter ? Leur idée est donc de créer un programme qui interagirait avec la base Open Food Facts pour en récupérer les aliments, les comparer et proposer à l'utilisateur un substitut plus sain à l'aliment qui lui fait envie.Le programme est écrit en langage Python et respecte les conventions de la pep8.## ArchitectureLe projet comporte un fichier main.py à la racine, et trois dossiers : setup, API et database. - Le dossier setup contient un fichier setup.py, qui sert à créer la structure de la base de données, ainsi que database_filling.py dont le rôle est de remplir cette dernière avec les aliments. Ensuite, les deux autres dossiers comportent des classes.- Le dossier API contient deux classes :- category_and_products.py : qui contient les catégories et produits sous forme de classes- data_from_api.py : qui contient les méthodes pour envoyer les requêtes à l'API et les retourner- Un fichier urls.txt : qui contient la liste des urls sur lesquelles on va chercher les données - Le dossier database contient trois classes :- database_setup.py : qui contient les méthodes pour créer la base de données- database_populating.py : qui contient les méthodes pour remplir la base de données- database_interaction.py : qui contient les méthodes pour intéragir avec notre base- Un fichier tables.py : qui contient sous forme de dictionnaire les requêtes permettant de créer les différentes tables de la base## FonctionnementLa communication avec l'API se fait en python via le module requests, et gestion de la base de données via le module mysql-connector-python.La création de la base de données MySQL se fait avec le fichier setup.py, qui utilise les méthodes connect() et create_database() de la classe DataBaseSetup pour créer la base. pour ensuite appeler la méthode request() de la classe DataFromApi, qui remplit la base de données avec les données récupérées.Une fois la base de données crée, elle contient trois tables :  - aliment : qui contient simplement les aliments  - catégorie : qui stocke les catégories d'aliments - recherche : qui contient les recherches précédemment effectuées par l'utilisateurLa suite du "setup.py" utilise un objet de la classe DataFromApi avec lequel on appelle la méthode request() qui va récupérer les données des produits appartenant aux catégories suivantes : - pizzas bolognaise - chocolat noir  - liégeois  - citronnades  - yaourts aromatisés  - steak de boeuf  - céréales petit dej  - légumineuses  - Biscuits Spéculoos  - Chips Chacune de ces catégories est associée à une url, et chaque url a un nombre de pages sur lesquelles se trouvent les produits, par exemple https://fr.openfoodfacts.org/categorie/pizzas-a-la-bolognaise/1.json, https://fr.openfoodfacts.org/categorie/pizzas-a-la-bolognaise/2.json, etc..Le programme parcourt chaque url du fichier urls.txt, récupère les données sur toutes les pages disponibles, et appelle la méthode add_catégorie() de la classe DatabasePopulating pour remplir la base, avant de passer à la catégorie suivante.Les aliments récupérés sont stockés dans la table aliment avec les informations suivantes : - Nom de l'aliment- Nutri-Score- Description- Magasin où l'acheter- Lien vers la page du produit sur OpenFoodFacts- Id de sa catégorieUne fois cette préparation effectuée, les produits et catégories sont ajoutés dans la base, et l'utilisateur peut donc utiliser l'interface.L'interface propose à l'utilisateur de choisir parmi les catégories d'aliments précisées plus tôt, puis un aliment parmi une dizaine de la catégorie choisie.Le but est de donner à l'utilisateur un substitut plus sain, pour cela, le programme va chercher dans la base de données un aliment appartenant à la même catégorie, mais avec un meilleur Nutri-Score. Le programme affiche le résultat de sa recherche, et la stocke dans la table recherche de la base.Le programme permet également de consulter les anciens produits recherchés, avec la date et l'heure de la recherche, le produit choisi, et le substitut qui avait été donné.## InstallationAvant de détailler l'installation du programme, quelques prérequis sont nécessaires. Le projet fonctionne avec le langage python (version 3.6.5), et le SGBD MySQL(version 8.0.8) qui sont nécessaires d'installer. Il vous faudra aussi git pour pouvoir cloner le projet en local.Voici les liens d'installation :- https://openclassrooms.com/fr/courses/235344-apprenez-a-programmer-en-python/230659-decouvrez-python#r-2447950Une fois python installé, installez pip, il servira pour installer les paquets nécessaires au projet:- https://pip.pypa.io/en/stable/installing/Maintenant vous pouvez commencer à installer MySQL :- https://openclassrooms.com/fr/courses/1959476-administrez-vos-bases-de-donnees-avec-mysql/1959969-installez-mysqlPour l'installation de MySQL, je vous recommande de suivre le tutoriel jusqu'à cet endroit, pour avoir créé votre compte superuser et vous connecter avec : - https://openclassrooms.com/fr/courses/1959476-administrez-vos-bases-de-donnees-avec-mysql/1959969-installez-mysql#/id/r-1977481Puis de vous connecter à votre serveur MySQL, et enfin exécuter ces deux commandes :```CREATE USER 'student'@'localhost' IDENTIFIED BY 'password';GRANT ALL PRIVILEGES ON purbeurre.* TO 'student'@'localhost';```Il ne vous reste maintenant plus qu'à installer git, avant de cloner le projet :- https://git-scm.com/book/fr/v2/D%C3%A9marrage-rapide-Installation-de-GitClonage du projet :Ouvrez un terminal (aussi appelé invite de commande) puis rendez vous dans le dossier où vous voulez l'installer en utilisant la commande : cd (nom de dossier) ou cd .. pour remonter d'un dossier.Une fois au bon endroit, lancez la commande suivante :```git clone https://github.com/AntoineMaurin/OpenFoodRooms.git```Puis pour installer les paquets nécessaires :``` pip install requirements.txt```Parfait, on touche au but ! Il ne vous reste plus qu'à avancer d'un dossier avec la commande ```cd OpenFoodRooms```Et vous y êtes !## UtilisationPour la 1ère utilisation, lorsque vous êtes dans le dossier OpenFoodRooms, lancez la commande ```python setup.py```Cela peut prendre quelques minutes, mais une fois terminé, vous n'avez plus qu'à lancer la commande suivante pour utiliser le programme :```python main.py```Le programme se lance, l'utilisateur est sur le terminal. Ce dernier lui affiche les choix suivants :1. Choisir une catégorie d'aliment que vous souhaitez remplacer2. Voir mes aliments substituésSi l'utilisateur sélectionne 1 :Le programme pose les questions suivantes à l'utilisateur et ce dernier sélectionne les réponses :- Sélectionnez la catégorie. [Plusieurs propositions associées à un chiffre. L'utilisateur entre le chiffre correspondant et appuie sur entrée]- Sélectionnez l'aliment. [Plusieurs propositions associées à un chiffre. L'utilisateur entre le chiffre correspondant à l'aliment choisi et appuie sur entrée]- Le programme propose un substitut, sa description, un magasin ou l'acheter (le cas échéant) et un lien vers la page d'Open Food Facts concernant cet aliment.- L'utilisateur a alors la possibilité d'enregistrer le résultat dans la base de données.Si l'utilisateur sélectionne 2 :- Le programme lui affiche ses recherches effectuées avec l'aliment, le substitut et la date de la recherche.