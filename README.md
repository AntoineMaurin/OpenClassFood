﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿# Projet 5 - OpenFoodRooms## PrésentationCe projet est un exercice de formation Python utilisant les données publiques de l'API OpenFoodFacts.La startup Pur Beurre connait bien les habitudes alimentaires françaises. Leur restaurant, Ratatouille, remporte un succès croissant et attire toujours plus de visiteurs sur la butte de Montmartre.L'équipe a remarqué que leurs utilisateurs voulaient bien changer leur alimentation mais ne savaient pas bien par quoi commencer. Remplacer le Nutella par une pâte aux noisettes, oui, mais laquelle ? Et dans quel magasin l'acheter ? Leur idée est donc de créer un programme qui interagirait avec la base Open Food Facts pour en récupérer les aliments, les comparer et proposer à l'utilisateur un substitut plus sain à l'aliment qui lui fait envie.Le programme est écrit en langage Python et respecte les conventions de la pep8.## ArchitectureLe projet comporte un fichier main.py, un fichier setup.py et un fichier config.py à la racine, et trois dossiers : models, API et database.Pour commencer avec les fichiers à la racine, le config.py doit être édité par l'utilisateur, car c'est là où il doit renseigner les informations de connexion à sa base de données. Effectivement, l'utilisateur doit créer lui même la base de données, le programme se charge de créer les tables et de les remplir. Ensuite, le setup sert donc à créer les tables de la base en se servant du fichier de config, pour mettre en place la structure de la base et la remplir avec les données de l'API OpenFoodFacts. Et le main est simplement le programme principal, qui permet à l'utilisateur d'intéragir avec le programme.Maintenant les dossiers :Le dossier models contient deux fichiers :- category.py - product.py Ce sont tous deux des classes qui représentent les tables aliment et catégorie de la base de données. Le programme principal passe par ces modèles pour interagir avec la base de données.Le dossier API contient ceci :- data_from_api.py : qui se charge de récupérer les données de l'API, et demande à la classe DatabasePopulating de les ajouter dans la base.- Un fichier urls.txt : qui contient la liste des urls qui correspondent aux catégories d'aliments, sur lesquelles on va aller chercher les données.Le dossier database contient deux classes et un fichier de tables :- database_populating.py : qui se charge de remplir la base de données avec les données de l'API.- database_request.py : qui sert à effectuer la plupart des requêtes SQL avec le connecteur python : mysql-connector.- Un fichier tables.py : qui contient sous forme de dictionnaire les tables et leur requête permettant de créer la base.## FonctionnementLa communication avec l'API se fait en python via le module requests, et gestion de la base de données via le module mysql-connector-python.La création de la base de données étant laissée à l'utilisateur, la création des tables se fait avec le fichier setup.py, qui utilise la méthode create_tables() de la classe DatabaseRequest pour créer la structure.Ensuite, le remplissage se fait avec la méthode request() de la classe DataFromApi, (toujours dans le fichier setup.py) qui intéragit au fur et à mesure du remplissage, avec la classe DatabasePopulating.Une fois le setup effectué, nous avons trois tables :  - aliment : qui stocke simplement les aliments  - catégorie : qui stocke les catégories d'aliments - recherche : qui contient les recherches précédemment effectuées par l'utilisateurLe remplissage se fait sur plusieurs catégories d'aliments : - pizzas bolognaise - chocolat noir  - liégeois  - citronnades  - yaourts aromatisés  - steak de boeuf  - céréales petit dej  - légumineuses  - Biscuits Spéculoos  - Chips Chacune de ces catégories est associée à une url, qui se trouve dans le fichier urls.txt. Vous pouvez en ajouter vous même, en modifiant l'url de la façon suivante :Prenez la catégorie "boissons au café" du site OpenFoodFacts, l'url est la suivante :https://fr.openfoodfacts.org/categorie/boissons-au-cafeVous la collez à la ligne suivante dans le fichier urls.txt et ajoutez .json à la fin. Vous pouvez prendre exemple sur celles déjà présentes si ce n'est pas clair.Donc en remplissant la base, le programme parcourt chaque url du fichier urls.txt, récupère les données sur toutes les pages disponibles, et appelle la méthode add_catégorie() de la classe DatabasePopulating pour remplir la base, avant de passer à la catégorie suivante.Les aliments récupérés sont stockés dans la table aliment avec les informations suivantes : - Nom de l'aliment- Nutri-Score- Description- Magasin où l'acheter- Lien vers la page du produit sur OpenFoodFacts- Id de sa catégorieUne fois le remplissage terminé, les produits et catégories sont ajoutés dans la base, et l'utilisateur peut donc utiliser l'interface.L'interface propose à l'utilisateur de choisir parmi les catégories d'aliments précisées plus tôt, puis un aliment parmi une dizaine de la catégorie choisie.Le but est de donner à l'utilisateur un substitut plus sain, pour cela, le programme va chercher dans la base de données un aliment appartenant à la même catégorie, mais avec un meilleur Nutri-Score. Le programme affiche le résultat de sa recherche, et propose à l'utilisateur de l'enregistrer.Le programme permet donc de consulter les anciens produits recherchés, avec la date et l'heure de la recherche, le produit choisi, et le substitut qui avait été donné.## InstallationAvant de détailler l'installation du programme, quelques prérequis sont nécessaires. Le projet fonctionne avec le langage python (version 3.6.5), et le SGBD MySQL(version 8.0.8) qui sont nécessaires d'installer. Il vous faudra aussi git pour pouvoir cloner le projet en local.Voici les liens d'installation :- https://openclassrooms.com/fr/courses/235344-apprenez-a-programmer-en-python/230659-decouvrez-python#r-2447950Une fois python installé, installez pip, il servira pour installer les paquets nécessaires au projet:- https://pip.pypa.io/en/stable/installing/Maintenant vous pouvez commencer à installer MySQL :- https://openclassrooms.com/fr/courses/1959476-administrez-vos-bases-de-donnees-avec-mysql/1959969-installez-mysqlPour l'installation de MySQL, je vous recommande de suivre le tutoriel jusqu'à cet endroit, pour avoir créé votre compte superuser et vous connecter avec : - https://openclassrooms.com/fr/courses/1959476-administrez-vos-bases-de-donnees-avec-mysql/1959969-installez-mysql#/id/r-1977481Puis de vous connecter à votre serveur MySQL, et enfin exécuter cette commande :```CREATE DATABASE OpenFoodRooms CHARACTER SET 'utf8';```Cela crée la base de données, je l'ai appelée "OpenFoodRooms" ici mais vous pouvez mettre le nom que vous voulez.Il ne vous reste maintenant plus qu'à installer git, avant de cloner le projet :- https://git-scm.com/book/fr/v2/D%C3%A9marrage-rapide-Installation-de-GitClonage du projet :Ouvrez un terminal (aussi appelé invite de commande) puis rendez vous dans le dossier où vous voulez l'installer en utilisant la commande : cd (nom de dossier) pour vous déplacer ou cd .. pour remonter d'un dossier, par exemple : ```cd Documents/Projets_Github/OpenFoodRooms```ou simplement dossier par dossier :```cd Documents```Une fois au bon endroit, lancez la commande suivante :```git clone https://github.com/AntoineMaurin/OpenFoodRooms.git```Puis pour installer les paquets nécessaires :```pip install requirements.txt```Parfait, on touche au but ! Il ne vous reste plus qu'à avancer d'un dossier avec la commande ```cd OpenFoodRooms```Et vous y êtes !## UtilisationPour la 1ère utilisation, vous devez éditer le fichier config.py pour y mettre les informations nécessaires à la connexion avec votre base. Le fichier se présente comme cela :```DB_CONFIG = {    'host': 'localhost',    'user': 'student',    'password': 'password',    'db_name': 'purbeurre'}```Remplacez les informations avec les vôtres ('db_name' correspond au nom que vous avez donné à votre base de données fraichement créée)Maintenant assurez vous que vous êtes dans le dossier OpenFoodRooms, si oui, vous pouvez commencer le remplissage de votre base en lançant la commande :```python setup.py```Cela peut prendre quelques minutes, mais une fois terminé, vous n'avez plus qu'à lancer la commande suivante pour utiliser le programme :```python main.py```Le programme se lance, vous pouvez vous laisser guider par l'application !Pour les utilisations futures, revenez dans le répertoire du projet et lancez seulement la commande ```python main.py```